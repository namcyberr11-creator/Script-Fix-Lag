-- VUKHOA FIX LAG: HARD-FORCE FAST MODE & V4 HIDER
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local Lighting = game:GetService("Lighting")

-- 1. HÀM ÉP FAST MODE (HARDWARE OPTIMIZATION)
local function ForceFastMode()
    -- Ép cấu hình đồ họa xuống mức thấp nhất của engine
    settings().Rendering.QualityLevel = 1
    settings().Rendering.MeshPartDetailLevel = Enum.MeshPartDetailLevel.Minimal
    
    -- Tắt các hiệu ứng hậu kỳ gây lag (Bloom, Blur, SunRays)
    for _, effect in pairs(Lighting:GetChildren()) do
        if effect:IsA("PostEffect") or effect:IsA("BloomEffect") or effect:IsA("BlurEffect") or effect:IsA("SunRaysEffect") then
            effect.Enabled = false
        end
    end
    
    -- Chỉnh ánh sáng về mức cơ bản nhất
    Lighting.GlobalShadows = false
    Lighting.FogEnd = 9e9
    Lighting.Brightness = 1
    Lighting.ClockTime = 12 -- Giữ trời sáng để đỡ tốn tài nguyên xử lý bóng tối
    
    -- Làm mượt vật liệu
    sethiddenproperty(workspace.Terrain, "Decoration", false)
    workspace.Terrain.WaterWaveSize = 0
    workspace.Terrain.WaterWaveSpeed = 0
    workspace.Terrain.WaterReflectance = 0
    workspace.Terrain.WaterTransparency = 0
end

-- 2. GIAO DIỆN UI (CHỮ ĐEN VIỀN TRẮNG)
local ScreenGui = Instance.new("ScreenGui", CoreGui)
local Label = Instance.new("TextLabel", ScreenGui)
Label.BackgroundTransparency = 1
Label.Position = UDim2.new(0.5, -150, 0.05, 0)
Label.Size = UDim2.new(0, 300, 0, 60)
Label.Font = Enum.Font.SourceSansBold
Label.TextSize = 35
Label.TextColor3 = Color3.new(0, 0, 0)
Label.TextStrokeColor3 = Color3.new(1, 1, 1)
Label.TextStrokeTransparency = 0 

RunService.RenderStepped:Connect(function(dt)
    Label.Text = "VuKhoa FixLag\nFPS: " .. math.floor(1/dt)
end)

-- 3. HÀM ẨN TẤT CẢ HIỆU ỨNG TỘC V4 & SKILLS
local function HideAll(v)
    -- Tắt hạt, tia sét, vệt sáng
    if v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Beam") then
        v.Enabled = false
    end
    -- Ẩn số sát thương
    if v:IsA("BillboardGui") or v.Name == "DamageIndicator" then
        v.Enabled = false
    end
    -- Ép tàng hình Mesh kỹ năng (Soul Guitar, V4, v.v.)
    if v:IsA("BasePart") or v:IsA("MeshPart") then
        local n = v.Name:lower()
        if n:find("v4") or n:find("aura") or n:find("lightning") or n:find("soul") or n:find("effect") then
            if not v:IsDescendantOf(game.Players.LocalPlayer.Character) then
                v.Transparency = 1
                v.LocalTransparencyModifier = 1
            end
        end
    end
end

-- 4. KÍCH HOẠT VÀ DUY TRÌ
ForceFastMode()
for _, v in pairs(workspace:GetDescendants()) do HideAll(v) end
workspace.DescendantAdded:Connect(HideAll)

-- Ẩn map (giữ va chạm)
for _, v in pairs(workspace:GetDescendants()) do
    if v:IsA("BasePart") and not v:IsDescendantOf(game.Players.LocalPlayer.Character) then
        if v.Name == "Tree" or v.Name == "Leaf" or v.Name == "Bush" or v:IsA("MeshPart") or v:IsA("UnionOperation") then
            v.Transparency = 1
        end
    end
end

print("VuKhoa FixLag: Hard-Force Fast Mode Loaded!")
