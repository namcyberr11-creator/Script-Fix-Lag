-- VUKHOA FIX LAG: SUPER-FIX (CHẮC CHẮN BẬT ĐƯỢC)
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")
local lp = Players.LocalPlayer

-- Xóa sạch UI cũ để không bị kẹt nút
for _, oldUI in pairs(CoreGui:GetChildren()) do
    if oldUI.Name == "VuKhoaUltimateUI" or oldUI.Name:find("VuKhoa") then
        oldUI:Destroy()
    end
end

-- 1. TẠO GIAO DIỆN
local ScreenGui = Instance.new("ScreenGui", CoreGui)
ScreenGui.Name = "VuKhoaUltimateUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.IgnoreGuiInset = true

-- Nhãn FPS Siêu To
local Label = Instance.new("TextLabel", ScreenGui)
Label.BackgroundTransparency = 1
Label.Position = UDim2.new(0.5, -250, 0.01, 0)
Label.Size = UDim2.new(0, 500, 0, 100)
Label.Font = Enum.Font.SourceSansBold
Label.TextSize = 55
Label.TextColor3 = Color3.new(0, 0, 0)
Label.TextStrokeColor3 = Color3.new(1, 1, 1)
Label.TextStrokeTransparency = 0 

RunService.RenderStepped:Connect(function(dt)
    Label.Text = "VuKhoa FixLag\nFPS: " .. math.floor(1/dt)
end)

-- 2. NÚT BẤM HÌNH ẢNH (KÉO THẢ ĐƯỢC)
local MapHidden = true -- Mặc định vào là BẬT luôn
local ToggleBtn = Instance.new("ImageButton", ScreenGui)
ToggleBtn.Name = "MainButton"
ToggleBtn.Size = UDim2.new(0, 90, 0, 90)
ToggleBtn.Position = UDim2.new(0, 20, 0.45, 0)
ToggleBtn.BackgroundColor3 = Color3.fromRGB(0, 180, 0) -- Màu xanh (Bật)
ToggleBtn.Active = true
ToggleBtn.Draggable = true 
ToggleBtn.ZIndex = 100

-- Dán ID ảnh Tết của bạn vào đây (Ví dụ mình để icon mặc định)
ToggleBtn.Image = "rbxassetid://123066218559720" 

local UICorner = Instance.new("UICorner", ToggleBtn)
UICorner.CornerRadius = UDim.new(0, 20)

-- Chữ trạng thái
local Status = Instance.new("TextLabel", ToggleBtn)
Status.Size = UDim2.new(1, 0, 1, 0)
Status.BackgroundTransparency = 1
Status.Text = "BẬT"
Status.Font = Enum.Font.SourceSansBold
Status.TextSize = 22
Status.TextColor3 = Color3.new(1, 1, 1)
Status.TextStrokeTransparency = 0.5

-- 3. HÀM QUÉT MAP (ANTI-LAG)
local function ApplyMapFix()
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("BasePart") and not v:IsDescendantOf(lp.Character) then
            local n = v.Name:lower()
            -- Xóa cây và cỏ vĩnh viễn
            if n:find("tree") or n:find("leaf") or n:find("bush") or n:find("grass") then
                v:Destroy()
            -- Ẩn Map 80%
            elseif v:IsA("MeshPart") or v:IsA("UnionOperation") or n:find("island") then
                v.Transparency = MapHidden and 0.8 or 0
            end
        end
    end
end

-- Chạy ngay lập tức khi dán script
task.spawn(ApplyMapFix)

-- 4. FIX LỖI KHÔNG BẬT ĐƯỢC (Dùng cả Click và Down)
local function Toggle()
    MapHidden = not MapHidden
    ToggleBtn.BackgroundColor3 = MapHidden and Color3.fromRGB(0, 180, 0) or Color3.fromRGB(180, 0, 0)
    Status.Text = MapHidden and "BẬT" or "TẮT"
    ApplyMapFix()
end

ToggleBtn.MouseButton1Down:Connect(Toggle)

-- 5. XÓA DAME (AUTO)
local function Clean(v)
    if v:IsA("BillboardGui") or v.Name:find("Damage") or v.Name == "DamageIndicator" then
        v:Destroy()
    end
    if v:IsA("ParticleEmitter") or v:IsA("Trail") then
        v.Enabled = false
    end
end

workspace.DescendantAdded:Connect(function(v)
    task.wait()
    Clean(v)
end)

-- Tối ưu Lighting ban đầu
game:GetService("Lighting").GlobalShadows = false
for _, v in pairs(workspace:GetDescendants()) do Clean(v) end

print("VuKhoa FixLag: SUPER-FIX LOADED!")
