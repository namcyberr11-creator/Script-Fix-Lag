-- VUKHOA FIX LAG: CLASSIC UI - SUPER LIGHT VERSION
local p = game.Players.LocalPlayer
local pgui = p:WaitForChild("PlayerGui")
local RunService = game:GetService("RunService")

-- 1. XÓA UI CŨ
if pgui:FindFirstChild("VuKhoa_Classic") then pgui.VuKhoa_Classic:Destroy() end

-- 2. TẠO GIAO DIỆN CŨ (VU KHOA FIX LAG)
local sg = Instance.new("ScreenGui", pgui)
sg.Name = "VuKhoa_Classic"
sg.ResetOnSpawn = false

local f = Instance.new("Frame", sg)
f.Size = UDim2.new(0, 200, 0, 80)
f.Position = UDim2.new(0.5, -100, 0, 50)
f.BackgroundColor3 = Color3.new(0, 0, 0)
f.BackgroundTransparency = 0.2
f.Active = true
f.Draggable = true -- Có thể kéo bảng

local t1 = Instance.new("TextLabel", f)
t1.Size = UDim2.new(0, 120, 0, 30)
t1.Position = UDim2.new(0, 75, 0, 10)
t1.Text = "Vũ Khoa Fix Lag"
t1.TextColor3 = Color3.new(0, 1, 1)
t1.BackgroundTransparency = 1
t1.TextSize = 15
t1.Font = Enum.Font.SourceSansBold

local t2 = Instance.new("TextLabel", f)
t2.Size = UDim2.new(0, 120, 0, 30)
t2.Position = UDim2.new(0, 75, 0, 40)
t2.Text = "FPS: ..."
t2.TextColor3 = Color3.new(1, 1, 1)
t2.BackgroundTransparency = 1
t2.TextSize = 17

local b = Instance.new("TextButton", f)
b.Size = UDim2.new(0, 60, 0, 60)
b.Position = UDim2.new(0, 10, 0.5, -30)
b.BackgroundColor3 = Color3.new(1, 0, 0)
b.Text = "OFF"
b.TextColor3 = Color3.new(1, 1, 1)
b.TextSize = 20

-- 3. HÀM TỐI ƯU SIÊU NHẸ (CHỈ CHẠY 1 LẦN KHI BẬT)
local active = false

local function ApplyFix()
    pcall(function()
        -- Ẩn nước biển
        workspace:FindFirstChildOfClass("Terrain").WaterTransparency = active and 1 or 0
        
        -- Xóa bầu trời
        for _, v in pairs(game.Lighting:GetChildren()) do
            if v:IsA("Sky") or v:IsA("Atmosphere") or v:IsA("Clouds") then
                v.Parent = active and game.HttpService or game.Lighting
            end
        end

        -- Ẩn đảo 90% (Quét 1 lần duy nhất)
        for _, v in pairs(workspace:GetDescendants()) do
            if v:IsA("BasePart") and not v:IsDescendantOf(p.Character) then
                if v:IsDescendantOf(workspace:FindFirstChild("Map")) or v.Name:lower():find("island") then
                    if v.Name ~= "Base" then
                        v.Transparency = active and 0.9 or 0
                    end
                end
            end
        end
    end)
end

-- 4. XÓA SÁT THƯƠNG (CƠ CHẾ LẮNG NGHE - KHÔNG LAG)
workspace.ChildAdded:Connect(function(v)
    if active and (v.Name == "DamageCounter" or v.Name:find("Damage")) then
        v:Destroy()
    end
end)

pgui.ChildAdded:Connect(function(v)
    if active and (v.Name:find("Damage") or v.Name:find("Counter")) then
        v:Destroy()
    end
end)

-- 5. LOGIC FPS & CLICK
RunService.RenderStepped:Connect(function(dt)
    t2.Text = "FPS: " .. math.floor(1/dt)
end)

b.MouseButton1Click:Connect(function()
    active = not active
    b.Text = active and "ON" or "OFF"
    b.BackgroundColor3 = active and Color3.new(0, 1, 0) or Color3.new(1, 0, 0)
    ApplyFix()
end)

-- 6. AUTO MARINE & 1.8S DELAY
task.spawn(function()
    local r = game:GetService("ReplicatedStorage")
    while not p.Team or p.Team.Name ~= "Marines" do
        pcall(function() r.Remotes.CommF_:InvokeServer("SetTeam", "Marines") end)
        task.wait(0.5)
    end
    task.wait(1.8) -- Đợi đúng 1.8s
    active = true
    b.Text = "ON"
    b.BackgroundColor3 = Color3.new(0, 1, 0)
    ApplyFix()
end)
