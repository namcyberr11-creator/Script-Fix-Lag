-- VUKHOA FIX LAG: HIDE 95% LEAVES & ROCKS (⭕/❌ EDITION)
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local lp = Players.LocalPlayer

-- 1. ÉP CHỌN MARINE
task.spawn(function()
    while not lp.Team do
        pcall(function() ReplicatedStorage.Remotes.CommF_:InvokeServer("SetTeam", "Marines") end)
        task.wait(1)
    end
end)

-- Xóa UI cũ
for _, v in pairs(CoreGui:GetChildren()) do
    if v.Name:find("VuKhoa") then v:Destroy() end
end

-- 2. TẠO GIAO DIỆN NÚT BẤM
local ScreenGui = Instance.new("ScreenGui", CoreGui)
ScreenGui.Name = "VuKhoa_Alpha_UI"
ScreenGui.DisplayOrder = 9999

local MapHidden = true

local ToggleBtn = Instance.new("ImageButton", ScreenGui)
ToggleBtn.Size = UDim2.new(0, 85, 0, 85)
ToggleBtn.Position = UDim2.new(0, 15, 0.4, 0)
ToggleBtn.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
ToggleBtn.Draggable = true 
ToggleBtn.Active = true
ToggleBtn.Image = "rbxassetid://6031068433"

local UICorner = Instance.new("UICorner", ToggleBtn)
UICorner.CornerRadius = UDim.new(0, 20)

local StatusLabel = Instance.new("TextLabel", ToggleBtn)
StatusLabel.Size = UDim2.new(1, 0, 1, 0)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "⭕"
StatusLabel.TextSize = 50
StatusLabel.TextColor3 = Color3.new(1, 1, 1)

-- 3. HÀM ẨN 95% LÁ CÂY VÀ ĐÁ
local function Apply95PercentFix()
    local terrain = workspace:FindFirstChildOfClass("Terrain")
    if terrain then terrain.WaterTransparency = MapHidden and 1 or 0 end

    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("BasePart") and not v:IsDescendantOf(lp.Character) then
            local n = v.Name:lower()
            local isLeaf = n:find("leaf") or n:find("leaves") or n:find("tree")
            local isRock = n:find("rock") or n:find("stone") or n:find("boulder")
            
            -- Quét màu lá và đá từ ảnh bạn gửi
            local isTargetColor = 
                (v.Color == Color3.fromRGB(106, 127, 63)) or 
                (v.Color == Color3.fromRGB(58, 92, 53)) or  
                (v.Color == Color3.fromRGB(111, 111, 111))

            if isLeaf or isRock or isTargetColor then
                v.Transparency = MapHidden and 0.95 or 0
            elseif v:IsA("MeshPart") or v:IsA("UnionOperation") or n:find("island") then
                v.Transparency = MapHidden and 0.95 or 0
            end
        end
    end
end

task.spawn(Apply95PercentFix)

-- 4. XỬ LÝ CLICK
ToggleBtn.MouseButton1Click:Connect(function()
    MapHidden = not MapHidden
    if MapHidden then
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
        StatusLabel.Text = "⭕"
    else
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
        StatusLabel.Text = "❌"
    end
    Apply95PercentFix()
end)

print("VuKhoa FixLag: San sang!")
