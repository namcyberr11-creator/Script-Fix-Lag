-- VUKHOA AUTO CHAT: 6S PRECISION & CUSTOMIZABLE
local p = game.Players.LocalPlayer
local pgui = p:WaitForChild("PlayerGui")
local TextChatService = game:GetService("TextChatService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

-- 1. XÓA UI CŨ
if pgui:FindFirstChild("VuKhoa_AutoChat_6s") then pgui.VuKhoa_AutoChat_6s:Destroy() end

-- 2. TẠO GIAO DIỆN CHUẨN VUKHOA
local sg = Instance.new("ScreenGui", pgui)
sg.Name = "VuKhoa_AutoChat_6s"
sg.ResetOnSpawn = false

local f = Instance.new("Frame", sg)
f.Size = UDim2.new(0, 200, 0, 160)
f.Position = UDim2.new(0.5, -100, 0.2, 0)
f.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
f.Active = true
f.Draggable = true
Instance.new("UICorner", f).CornerRadius = UDim.new(0, 12)
local stroke = Instance.new("UIStroke", f)
stroke.Color = Color3.fromRGB(0, 150, 255)
stroke.Thickness = 2

local tTitle = Instance.new("TextLabel", f)
tTitle.Size = UDim2.new(1, 0, 0, 30)
tTitle.Text = "Vũ Khoa Auto Chat"
tTitle.TextColor3 = Color3.new(0, 1, 1)
tTitle.BackgroundTransparency = 1
tTitle.Font = Enum.Font.SourceSansBold
tTitle.TextSize = 16

-- Ô NHẬP NỘI DUNG
local inputMsg = Instance.new("TextBox", f)
inputMsg.Size = UDim2.new(0, 180, 0, 40)
inputMsg.Position = UDim2.new(0.5, -90, 0.22, 0)
inputMsg.Text = "Cay thue inboxx ngvanbachh17909._"
inputMsg.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
inputMsg.TextColor3 = Color3.new(1, 1, 1)
inputMsg.TextWrapped = true
inputMsg.ClearTextOnFocus = false
Instance.new("UICorner", inputMsg)

-- Ô NHẬP GIÂY (MẶC ĐỊNH 6)
local inputDelay = Instance.new("TextBox", f)
inputDelay.Size = UDim2.new(0, 180, 0, 25)
inputDelay.Position = UDim2.new(0.5, -90, 0.52, 0)
inputDelay.Text = "6"
inputDelay.PlaceholderText = "Số giây..."
inputDelay.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
inputDelay.TextColor3 = Color3.new(1, 1, 1)
Instance.new("UICorner", inputDelay)

-- NÚT BẬT/TẮT
local b = Instance.new("TextButton", f)
b.Size = UDim2.new(0, 160, 0, 30)
b.Position = UDim2.new(0.5, -80, 0.75, 0)
b.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
b.Text = "CHAT: OFF"
b.TextColor3 = Color3.new(1, 1, 1)
b.Font = Enum.Font.SourceSansBold
Instance.new("UICorner", b)

-- 3. HÀM GỬI TIN NHẮN TỐI ƯU
local function SendChat(msg)
    pcall(function()
        if TextChatService.ChatVersion == Enum.ChatVersion.TextChatService then
            local channel = TextChatService.TextChannels.RBXGeneral
            channel:SendAsync(msg)
        else
            -- Bỏ qua request delay của hệ thống cũ bằng cách gọi thẳng Server
            ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer(msg, "All")
        end
    end)
end

-- 4. LOGIC ĐẾM THỜI GIAN THỰC CHÍNH XÁC
local isChatting = false
local lastChatTick = 0

local function ToggleChat(state)
    isChatting = state
    b.Text = isChatting and "CHAT: ON" or "CHAT: OFF"
    b.BackgroundColor3 = isChatting and Color3.fromRGB(0, 180, 0) or Color3.fromRGB(200, 0, 0)
    if isChatting then lastChatTick = tick() end
end

b.MouseButton1Click:Connect(function()
    ToggleChat(not isChatting)
end)

-- Sử dụng Heartbeat để kiểm tra liên tục (60 lần/giây) thay vì task.wait
RunService.Heartbeat:Connect(function()
    if isChatting then
        local customDelay = tonumber(inputDelay.Text) or 6
        if tick() - lastChatTick >= customDelay then
            SendChat(inputMsg.Text)
            lastChatTick = tick() -- Reset ngay lập tức
        end
    end
end)

-- 5. AUTO CHẠY SAU 2S CHỌN PHE
task.spawn(function()
    while not p.Team do task.wait(0.1) end
    task.wait(2)
    ToggleChat(true)
end)
