-- VUKHOA AUTO CHAT: ONE TIME & STOP (ANTI-TAG)
local p = game.Players.LocalPlayer
local pgui = p:WaitForChild("PlayerGui")
local TextChatService = game:GetService("TextChatService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- 1. XÓA UI CŨ
if pgui:FindFirstChild("VuKhoa_OneTime_Chat") then pgui.VuKhoa_OneTime_Chat:Destroy() end

-- 2. TẠO GIAO DIỆN NHỎ GỌN
local sg = Instance.new("ScreenGui", pgui)
sg.Name = "VuKhoa_OneTime_Chat"
sg.ResetOnSpawn = false

local f = Instance.new("Frame", sg)
f.Size = UDim2.new(0, 240, 0, 100)
f.Position = UDim2.new(0.5, -120, 0.4, 0) -- Giữa màn hình, tránh logo
f.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
f.Active = true
f.Draggable = true
Instance.new("UICorner", f)
local stroke = Instance.new("UIStroke", f)
stroke.Color = Color3.fromRGB(0, 255, 150)

local tTitle = Instance.new("TextLabel", f)
tTitle.Size = UDim2.new(1, 0, 0, 30)
tTitle.Text = "Auto Chat 1 Lần Duy Nhất"
tTitle.TextColor3 = Color3.new(1, 1, 1)
tTitle.BackgroundTransparency = 1
tTitle.Font = Enum.Font.SourceSansBold

local inputMsg = Instance.new("TextBox", f)
inputMsg.Size = UDim2.new(0, 220, 0, 40)
inputMsg.Position = UDim2.new(0.5, -110, 0.4, 0)
inputMsg.Text = "Cay thue inboxx ngvanbachh17909._"
inputMsg.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
inputMsg.TextColor3 = Color3.new(1, 1, 1)
inputMsg.TextWrapped = true
inputMsg.ClearTextOnFocus = false
Instance.new("UICorner", inputMsg)

local status = Instance.new("TextLabel", f)
status.Size = UDim2.new(1, 0, 0, 20)
status.Position = UDim2.new(0, 0, 0.8, 0)
status.Text = "Chờ chọn phe..."
status.TextColor3 = Color3.fromRGB(255, 255, 0)
status.BackgroundTransparency = 1
status.TextSize = 12

-- 3. BỘ CHUYỂN ĐỔI CHỐNG TAG (DỄ ĐỌC)
local function FullBypass(text)
    local map = {
        ["a"]="а", ["c"]="с", ["e"]="е", ["i"]="і", ["o"]="о", 
        ["p"]="р", ["s"]="ѕ", ["u"]="υ", ["y"]="у", ["x"]="х",
        ["v"]="ѵ", ["n"]="ո"
    }
    local result = ""
    for i = 1, #text do
        local char = text:sub(i, i):lower()
        result = result .. (map[char] or char)
    end
    return result .. " ."
end

-- 4. LOGIC CHAT 1 LẦN
task.spawn(function()
    -- Đợi đến khi bạn chọn phe (Team)
    while not p.Team do task.wait(0.5) end
    
    status.Text = "Đã chọn phe! Sẽ chat sau 3 giây..."
    task.wait(3)
    
    local msg = FullBypass(inputMsg.Text)
    
    pcall(function()
        if TextChatService.ChatVersion == Enum.ChatVersion.TextChatService then
            TextChatService.TextChannels.RBXGeneral:SendAsync(msg)
        else
            ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer(msg, "All")
        end
    end)
    
    status.Text = "Đã chat xong! Script dừng."
    status.TextColor3 = Color3.fromRGB(0, 255, 0)
    
    -- Tự động ẩn UI sau 5 giây cho gọn màn hình
    task.wait(5)
    f.Visible = false
end)
